{% import "macros.html" as macros %}
{% extends "base.html" %}

{% block extra_css %}<link rel="stylesheet" type="text/css" href="/css/dataset.css">{% endblock %}

{% block body_content %}
<script>
  LX.dataset.write_graph("{{dataset.name}}");
</script>
<script>
  LX.drawGraphs(["{{dataset.name}}"]);
</script>

{% if dataset.description %}
<strong>description:</strong> {{dataset.description }}
{% else %}
(sorry, no description for this dataset)
{% endif %}

<fieldset>
  <legend>edit data series</legend>
  <h3>existing</h3>
  {% if series %}
  {% for s in series %}
  {% set s_id = s.key().id() %}
  <div id="existing_series"
       onmouseover="LX.dataset.show_delete('{{s_id}}')"
       onmouseout="LX.dataset.hide_delete('{{s_id}}')">
    <img id="delete_img_{{s_id}}"
         src="/images/delete.png"
         alt="delete this data series"
         style="visibility: hidden"
         onclick="LX.dataset.remove_series_xhr('{{s_id}}')"/>
    interval: {{s.interval}}
    max age: {{s.max_age}}
  </div>
  {% endfor %}
  {% else %}
  none yet &mdash; you ought to add some
  {% endif %}
  <div 
     onmouseover="LX.dataset.show_add()"
     onmouseout="LX.dataset.hide_add()">
    <h3>add new</h3>
    <img id="add_img" src="/images/add.png" alt="add a new data series" style="visibility: hidden"/>
    <input type="hidden" id="ds_name" value="{{dataset.name}}"/>
    {{ macros.label_with_input('interval', 'new_ival', 'interval', size=5, br=False) }}
    <span style="padding-left: 1em;">
      {{ macros.label_with_input('max age', 'new_max_age', 'max_age', size=7, br=False)}} 
    </span>
    <span id="add_new_button"></span>
    <script>
      LX.ui.draw_button('add_new_button', 'add', LX.dataset.add_series_xhr);
    </script>
  </div>
</fieldset>

{% if can_delete %}
<form action="/delete/dataset" method="POST">
  <fieldset>
    <legend>delete this dataset</legend>
    <input type=checkbox name="delete_confirm" id="delete_confirm"><label for="delete_confirm">yes, i really want to permanently and irreversible delete <q>{{dataset.name}}</q></label><br />
    <input type="hidden" name="name" value="{{dataset.name}}" />
    <input type="submit" value="delete it" />
{% endif %}
{% endblock %}
